<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css">
    <link rel="stylesheet" type= "text/css" href="css/style.css">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
    <!-- jQuery library -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.4.1.js"></script>

    <!-- Material Design Bootstrap -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/mdbootstrap/4.18.0/css/mdb.min.css" rel="stylesheet">
    <!-- Latest compiled JavaScript -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Quicksand">
</head>
<style>

    h1{
        margin: 0;
        display: inline-block;
    }
    h2{
        text-align : center;
        font-size: 50px;
        padding-bottom: 5%;
    }
    .form-group{
        padding-left:10%;
    }

    body{
        background-color:#f2f2f2;
        font-size: 15px;
        font-family: 'Quicksand';
        color:#6B6B6B;
    }

</style>
<body>
<div class = "topnav">
    <a id="home" href = "list.html"><i class="glyphicon glyphicon-home"></i></a>
    <a id="logout" onclick="logout()">Logout</a>
</div>
<div class="jumbotron jumbotron-fluid">
    <div id = "main" class="container">
        <div class="row">
            <h1 class="col-8">List Of Events</h1>
            <div class="col-4" style="display: flex; justify-content: flex-end;">
                <button type="button" class="myButton btn btn-success btn-circle btn-xl align-self-end" id="myBtn"> + </button>
            </div>
        </div>
    </div>
    <!-- Trigger/Open The Popup -->

    <!-- The Popup -->
    <div id="myModal" class="modal">

        <!-- Popup content -->
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>Add a New Event</h2>

            <div>
                <div class="form-group row">
                    <label for="eventname" class="col-md-2 col-form-label">Name</label>
                    <div class="col-md-3">
                        <input type="text" class="form-control" id="eventname" placeholder="Name">
                    </div>
                </div>

                <div class="form-group row">
                    <label for="eventdescription" class="col-md-2 col-form-label">Description</label>
                    <div class="col-md-8">
                        <textarea class="form-control" id="eventdescription" rows="5"></textarea>
                    </div>
                </div>



                <div class="form-group row">
                    <label for="eventdate" class="col-md-2 col-form-label">Date</label>
                    <div class="col-md-3">
                        <div class='input-group date' id='datetimepicker'>
                            <input type='text' id = "eventdate" class="form-control" />
                            <span class="input-group-addon">
                  <span class="glyphicon glyphicon-calendar" style="font-size: 20px"></span>
                </span>
                            <script type="text/javascript">
                                $(function () {
                                    $('#datetimepicker').datetimepicker();
                                });
                            </script>
                        </div>
                    </div>
                </div>


                <div class="form-group row">
                    <label for="eventlocation" class="col-md-2 col-form-label">Location</label>
                    <div class="col-md-3">
                        <select class="form-control" id="eventlocation">
                            <option>University Campus</option>
                            <option>Outside Campus (City)</option>
                            <option>Both</option>
                        </select>
                    </div>
                </div>

                <div class="bottomright" style="display: flex; justify-content: flex-end;">
                    <button onclick = "addEvent()" class="btn btn-success btn-circle btn-xl align-self-end">ADD</button>
                </div>
            </div>
        </div>
    </div>
</div>


<div class = "container">
    <!-- Search Bar -->
    <div class="col-md-3">
        <form class="form-inline d-flex justify-content-center md-form form-sm mt-0">
            <i class="fas fa-search" aria-hidden="true"></i>
            <input class="form-control form-control-sm ml-3 w-75" type="text" placeholder="Search"
                   aria-label="Search">
        </form>
    </div>


    <!-- Order By Dropdown Button-->
    <div class="col-md-9 dropdown" >
        <button type="button" class="btn btn-success dropdown-toggle" data-toggle="dropdown" style="float:right;">Order By</button>
        <div class="dropdown-menu dropdown-menu-right">
            <a class="dropdown-item" href="#">A - Z</a>
            <a class="dropdown-item" href="#">Event Date (New - Old)</a>
            <a class="dropdown-item" href="#">Event Date (Old - New)</a>
            <a class="dropdown-item" href="#">Recently Modified</a>
            <a class="dropdown-item" href="#">On Campus</a>
            <a class="dropdown-item" href="#">Outside Campus</a>
            <a class="dropdown-item" href="#">Within and Outside Campus</a>
        </div>
    </div>

    <!-- List of Events -->
    <div class= "col-md-12 col-sm-10">
        <!-- Event 1 -->
        <div class="project">
            <div class="row bg-white has-shadow">
                <div class="col-lg-12 col-md-12 d-flex align-items-center justify-content-between">
                    <h3 class="h4"><a href="event.html">Event Title</a></h3>
                    <h3 class="h4">20/4/2020</h3>
                    <h3 class="h4">Carl The Creator</h3>
                    <h3 class="h4">Eddie the Editor</h3>
                    <div class="col-md-1 col-sm-1 col-lg-1 d-flex justify-content-between">
                        <a href="edit.html" class="text-success"><i class="glyphicon glyphicon-pencil" style="font-size:20px;"></i></a>
                        <a href="edit.html" class="text-success"><i class="glyphicon glyphicon-trash" style="font-size:20px;"></i></a>
                    </div>
                </div>

            </div>
        </div>
    </div>
    <div class = "eventlist">
        <h2>OH BABY IT'S A LIST</h2>
        <table style = "width:100%" id = "eventtable">
        </table>
    </div>
    <div>
    <button onclick = addEvent()>Addboi</button>
    </div>
</div>
<script>

    // Get the modal
    var modal = document.getElementById("myModal");

    // Get the button that opens the modal
    var btn = document.getElementById("myBtn");

    // Get the <span> element that closes the modal
    var span = document.getElementsByClassName("close")[0];

    // When the user clicks the button, open the modal
    btn.onclick = function() {
        modal.style.display = "block";
    }

    // When the user clicks on <span> (x), close the modal
    span.onclick = function() {
        modal.style.display = "none";
    }

    // When the user clicks anywhere outside of the modal, close it
    window.onclick = function(event) {
        if (event.target == modal) {
            modal.style.display = "none";
        }
    }


    function createEvent(form) {
        const xhr = new XMLHttpRequest();
        xhr.open('POST', "http://localhost:8080/kickInTeam26/rest/events", true);
        xhr.onreadystatechange = function () {
            if (xhr.readyState == 4) {
                window.location.href = 'http://localhost:8080/kickInTeam26/event.html/' + xhr.responseText
                console.log(xhr.responseText);
            }
        }
        xhr.setRequestHeader("Content-Type", "application/json");
        xhr.send(JSON.stringify(form));
    }

    window.onload = function() {
        const xhr = new XMLHttpRequest();
        xhr.open('GET', "http://localhost:8080/kickInTeam26/rest/events", true);
        xhr.onreadystatechange = function () {
            if ((xhr.readyState == 4) && (xhr.status == 200)) {
                var table = document.getElementById("eventtable");
                var events = JSON.parse(xhr.responseText);
                console.log(events);
                var htmltext = "<tr><th>Name</th><th>Creator</th><th>Editor</th><th>Gimme dat info</th><th>Edit meeee</th><th>Gurbuge</th><tr>";
                table.innerHTML = htmltext;
                for (i = 0; i < events.length; i++) {
                    var row = table.insertRow(i + 1);
                    var cell1 = row.insertCell(0);
                    var cell2 = row.insertCell(1);
                    var cell3 = row.insertCell(2);
                    var cell4 = row.insertCell(3);
                    var cell5 = row.insertCell(4);
                    var cell6 = row.insertCell(5);
                    cell1.innerHTML = events[i].name;
                    cell2.innerHTML = events[i].createdBy;
                    cell3.innerHTML = events[i].lastEditedBy;
                    cell4.innerHTML = "<button onclick = 'window.location.href = \"http://localhost:8080/kickInTeam26/event.html?id=" + events[i].eventId + "\";'>Gib</button>"
                    cell5.innerHTML = "<button onclick = 'window.location.href = \"http://localhost:8080/kickInTeam26/edit.html?id=" + events[i].eventId + "\";'>Yeahbaby</button>"
                    cell6.innerHTML = "<button onclick = 'deleteEvent(" + events[i].eventId + ")'>Outta here</button>"


//				htmltext += "<div class= 'col-md-12 col-sm-10'><div class='project'><div class='row bg-white has-shadow'>" +
//				"<div class='col-lg-12 col-md-12 d-flex align-items-center justify-content-between'><h3 class='h4'><a href='event.html'>" + events[i].name + "</a>" +
//				"</h3><h3 class='h4'>20/4/2020</h3><h3 class='h4'>" + events[i].createdBy + "</h3><h3 class='h4'> " + events[i].lastEditedBy + "</h3>" +
//				"<div class='col-md-1 col-sm-1 col-lg-1 d-flex justify-content-between'><a href='edit.html' class='text-success'>" +
//				"<i class='glyphicon glyphicon-pencil' style='font-size:20px;'></i></a><a href='edit.html' class='text-success'> " +
//				"<i class='glyphicon glyphicon-trash' style='font-size:20px;'></i></a></div></div></div></div></div>"
                }
//			table.innerHTML = htmltext;
            }
        }
        xhr.setRequestHeader("Content-Type", "application/json");
        xhr.send();
    }
	function addEvent() {
		description = document.getElementById("eventdescription").value;
		namestuff = document.getElementById("eventname").value;
		locationstuff = document.getElementById("eventlocation");
		eventloc = locationstuff.options[locationstuff.selectedIndex].value
		eventdate = document.getElementById("eventdate").value;
		eventjson = {"createdBy":"CreaJoep", "description":description,"lastEditedBy":"EditJoep", "location":eventloc, "name":namestuff};
		console.log(JSON.stringify(eventjson));
		var xhr = new XMLHttpRequest();
		xhr.open('POST', "http://localhost:8080/kickInTeam26/rest/events", true);
		xhr.onreadystatechange = function() {
			if ((xhr.readyState == 4) && (xhr.status = 200)) {
				console.log(xhr.responseText);
				window.location.href = "http://localhost:8080/kickInTeam26/event.html?id=" + xhr.responseText;
			}
		}
		xhr.setRequestHeader("Content-Type", "application/json");
		xhr.send(JSON.stringify(eventjson));
	}
    function deleteEvent(id) {
		var xhr = new XMLHttpRequest();
		xhr.open('DELETE', "http://localhost:8080/kickInTeam26/rest/event/" + id, true);
		xhr.onreadystatechange = function () {
			if ((xhr.readyState == 4) && (xhr.status == 200)) {
				console.log(xhr.responseText);
			}
		}
		xhr.setRequestHeader("Content-Type", "application/json");
		xhr.send();
 	   }

    function logout(){
        const xhr = new XMLHttpRequest();
        xhr.open('DELETE', "http://localhost:8080/kickInTeam26/rest/authentication", true);
        xhr.onreadystatechange = function () {
            if (xhr.readyState == 4) {
                console.log(xhr.responseText);
                window.location.href="http://localhost:8080/kickInTeam26/login.html";
            }
        }
        xhr.setRequestHeader("Content-Type", "application/json");
        xhr.send();
    }

</script>
</body>

</html>